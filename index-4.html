<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tasks â€” Be Trillion</title>
  <link rel="stylesheet" href="./styles.css"/>
</head>
<body>
  <header class="app-header">
    <h1>Be Trillion â€” Tasks</h1>
    <nav class="tabs">
      <button class="tab-btn" data-tab="home">ãƒ›ãƒ¼ãƒ </button>
      <button class="tab-btn" data-tab="today">ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯</button>
      <button class="tab-btn" data-tab="kpi">KPIä¸€è¦§</button>
    </nav>
  </header>

  <main>
    <!-- ãƒ›ãƒ¼ãƒ  -->
    <section id="tab-home" class="tab-section">
      <div class="card">
        <h2>æ¦‚è¦</h2>
        <div class="row">
          <div>
            <div class="metric">
              <div class="metric-label">ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯</div>
              <div class="metric-value" id="home-today-count">0</div>
            </div>
          </div>
          <div>
            <div class="metric">
              <div class="metric-label">æœªå®Œäº†KPI</div>
              <div class="metric-value" id="home-kpi-open">0</div>
            </div>
          </div>
        </div>
        <div class="actions">
          <button id="go-today" class="primary">ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯ã‚’è¦‹ã‚‹</button>
          <button id="go-kpi" class="ghost">KPIä¸€è¦§ã‚’è¦‹ã‚‹</button>
        </div>
      </div>
    </section>

    <!-- ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯ -->
    <section id="tab-today" class="tab-section hidden">
      <div class="card">
        <h2>ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯</h2>
        <div class="task-input">
          <input type="text" id="new-task-input" placeholder="æ–°ã—ã„ã‚¿ã‚¹ã‚¯..." />
          <button id="add-task-btn" class="primary">è¿½åŠ </button>
        </div>
        <ul id="task-list" class="list"></ul>
        <div class="actions">
          <button id="to-home" class="ghost">ãƒ›ãƒ¼ãƒ ã¸</button>
          <button id="to-kpi" class="ghost">KPIä¸€è¦§ã¸</button>
        </div>
      </div>
    </section>

    <!-- KPIä¸€è¦§ -->
    <section id="tab-kpi" class="tab-section hidden">
      <div class="card">
        <h2>KPIä¸€è¦§</h2>
        <div class="kpi-input">
          <input type="text" id="kpi-title-input" placeholder="KPIã‚¿ã‚¤ãƒˆãƒ«" />
          <input type="date" id="kpi-deadline-input" />
          <button id="add-kpi-btn" class="primary">è¿½åŠ </button>
        </div>
        <ul id="kpi-list" class="list"></ul>
        <div class="actions">
          <button id="kpi-to-home" class="ghost">ãƒ›ãƒ¼ãƒ ã¸</button>
          <button id="kpi-to-today" class="ghost">ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯ã¸</button>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <span id="last-updated">â€”</span>
    <button id="force-save" class="ghost small">ä¿å­˜</button>
    <span class="sep">|</span>
    <span>ãƒ¦ãƒ¼ã‚¶ãƒ¼: <code id="uid-label">myUser</code></span>
  </footer>

  <!-- Firebase SDK (v10 modular) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    // ğŸ” ã‚ãªãŸã® Firebase è¨­å®šã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼ˆæ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚‚ã®ï¼‰
    // const firebaseConfig = { ... };
    // æ—¢ã« index-3.html ã«è¨­å®šãŒã‚ã‚‹ãªã‚‰ã€ãã®ã¾ã¾æµç”¨ã—ã¦ OK

    // ------------------------------------------------------------------
    // æ—¢å­˜ã® index-3.html ã‚’æµç”¨ã™ã‚‹å ´åˆã¯ã€ä¸Šã® firebaseConfig ã‚’å‰Šé™¤ã—ã€
    // ä¸‹è¨˜ã®è¡Œã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ã€window.appFirebase ã‚’å‚ç…§ã—ã¦ã‚‚OKã§ã™ã€‚
    // ã“ã“ã§ã¯å˜ä½“ã§å‹•ãã‚ˆã†ã€ãƒ€ãƒŸãƒ¼ã§ window.firebaseConfig ã‚’å‚ç…§ã—ã¾ã™ã€‚
    // ------------------------------------------------------------------
    const cfg = window.firebaseConfig || undefined;
    if (!cfg) {
      console.warn("âš ï¸ firebaseConfig ãŒæœªè¨­å®šã§ã™ã€‚è¨­å®šã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚");
    }
    const app = initializeApp(cfg || {});
    const db = getFirestore(app);

    // Firestore ãƒ©ãƒƒãƒ‘ï¼ˆå˜ä¸€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§é›†ç´„ï¼‰
    const USER_ID = "myUser"; // å¿…è¦ãªã‚‰å·®ã—æ›¿ãˆ
    const DATA_DOC = () => doc(db, "users", USER_ID);

    window.saveData = async function saveData(payload){
      const enriched = { ...payload, _updatedAt: serverTimestamp() };
      await setDoc(DATA_DOC(), enriched, { merge: true });
      return true;
    };
    window.loadData = async function loadData(){
      const snap = await getDoc(DATA_DOC());
      return snap.exists() ? snap.data() : null;
    };

    // ã‚¢ãƒ—ãƒªæœ¬ä½“
    import App from "./app.js";
    App({ saveData: window.saveData, loadData: window.loadData, userId: USER_ID });
  </script>
</body>
</html>
